  <html>
  <head>
  <meta charset="utf-8">
  <title>Desk Light Control</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css"></style>
	<style>
	#red, #green, #blue {
			float: left;
			clear: left;
			width: 300px;
			margin: 15px;
	}
	#swatch {
			width: 120px;
			height: 100px;
			margin-top: 18px;
			margin-left: 350px;
			background-image: none;
	}
  #a_preview div, #b_preview div{
			width: 120px;
			height: 100px;
			margin-top: 18px;
			margin-left: 350px;
			background-image: none;
  }
	.red .ui-slider-range { background: #ef2929; }
	.red .ui-slider-handle { border-color: #ef2929; }
	.green .ui-slider-range { background: #8ae234; }
	.green .ui-slider-handle { border-color: #8ae234; }
	.blue .ui-slider-range { background: #729fcf; }
	.blue .ui-slider-handle { border-color: #729fcf; }
	</style>

	<script src="jquery.js"></script>
  <script src="jquery-ui.js"></script>
	<script type="text/javascript">
		colors = {a: [0, 0, 0], b: [0, 0, 0], w: [0]};
		$.getJSON("/colors", function(data) {
  		colors = data;
		  updateFields();
		});

    function updateFields() {
				console.log(colors);

				// $("#a_red").val(colors.a[0]);
				// $("#a_grn").val(colors.a[1]);
				// $("#a_blu").val(colors.a[2]);

				// $("#b_red").val(colors.b[0]);
				// $("#b_grn").val(colors.b[1]);
				// $("#b_blu").val(colors.b[2]);

				// $("#w_brt").val(colors.w[0]);
		}
    function scale(colors) { 
        for (var color in colors) { 
            color = Math.round(Math.pow(color, (4/3.0)))
        }

      return colors; 
  
    }
    function submit() {
       var colors =     {a_red: $("#a_red").slider("value"), a_grn: $("#a_grn").slider("value"),
												 a_blu: $("#a_blu").slider("value"), b_red: $("#b_red").slider("value"),
												 b_grn: $("#b_grn").slider("value"), b_blu: $("#b_blu").slider("value"),
												 w_brt: $("#w_brt").slider("value"),}
				colors = scale(colors); 							
				$.post("/post", colors);
        refreshSwatch();
        setTimeout(submit, 100); 
		}
		$(function() {
				$(".slider").slider({
						orientation: "horizontal",
						range: "min",
						max: 64,
						value: 0,
						// slide: submit,
						// change: submit,
				});
    submit(); 
		})
    function refreshSwatch() {
        var colors =     {a_red: $("#a_red").slider("value"), a_grn: $("#a_grn").slider("value"),
												 a_blu: $("#a_blu").slider("value"), b_red: $("#b_red").slider("value"),
												 b_grn: $("#b_grn").slider("value"), b_blu: $("#b_blu").slider("value"),
												 w_brt: $("#w_brt").slider("value"),}
				colors = scale(colors); 							
      a_hex = hexFromRGB(colors.a_red, colors.a_grn, colors.a_blu);
      $("#a_preview div").css("background-color", "#" + a_hex );
      b_hex = hexFromRGB(colors.b_red, colors.b_grn, colors.b_blu);
      $("#b_preview div").css("background-color", "#" + b_hex );
    }
    function hexFromRGB(r, g, b) {
      var hex = [
        r.toString( 16 ),
        g.toString( 16 ),
        b.toString( 16 )
      ];
      $.each( hex, function( nr, val ) {
        if ( val.length === 1 ) {
          hex[ nr ] = "0" + val;
        }
      });
      return hex.join( "" ).toUpperCase();
    }
	</script>
  </head>
	<body>
  <a href="/on">On</a> <a href="/off">off</a>

  <h1>Light Control</h1>
	<table>
  	<tr>
  		<td>
  			<h2> Desk light </h2>
      </td>
    </tr>
    <tr>
      <td>
  			<div class="red slider"   id="a_red"></div>
      </td>
      <td id="a_preview" rowspan="4">
        <div></div>
      </td>
    </tr>
    <tr>
      <td>
  			<div class="green slider" id="a_grn"></div>
      </td>
    </tr>
    <tr>
      <td>
  			<div class="blue slider"  id="a_blu"></div>
      </td>
    </tr>
    <tr>
      <td>
        <h2> Window Light </h2>
      </td>
    </tr>
    <tr>
      <td>
        <div class="red slider"   id="b_red"></div>
      </td>
      <td id="b_preview" rowspan="4">
        <div></div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="green slider" id="b_grn"></div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="blue slider"  id="b_blu"></div>
      </td>
    </tr>
    <tr>
      <td>
        <h2> Work Light </h2>
      </td>
    </tr>
    <tr>
      <td>
  	    <div class="white slider" id="w_brt"></div>
      </td>
    </tr>
  </table>
  <input type="submit" href="#" onclick="submit()"/>
</body>
</html>
